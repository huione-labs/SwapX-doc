# 了解退货
SwapX 激励用户向交易池增加流动性，方法是向提供商奖励其他用户与这些池交易时产生的费用。做市通常是一项复杂的活动。与单纯持有资产相比，在基础资产价格大幅且持续波动期间存在亏损的风险。

# 文章中的示例
假设一个流动性提供者向一个池子里添加了 10,000 DAI 和 100 WETH（总价值为 20,000 美元），那么现在这个流动性池里总共有 100,000 DAI 和 1,000 ETH。由于供应量相当于总流动性的 10%，因此合约会铸造并向做市商发送“流动性代币”，使他们有权获得池子里可用流动性的 10%。这些不是可以交易的投机代币。它们只是一种会计或簿记工具，用于跟踪流动性提供者应得的金额。如果其他人随后添加/提取代币，则会铸造/销毁新的流动性代币，以使每个人在流动性池中的相对百分比份额保持不变。

现在让我们假设 Coinbase 上的价格从 100 美元涨至 150 美元。经过一些套利后，SwapX 合约也应该反映出这一变化。交易者将添加 DAI 并移除 ETH，直到新的比率变为 150:1。

流动性提供者会怎样？合约反映的数字接近 122,400 DAI 和 817 ETH（为了检查这些数字是否准确，122,400 * 817 = 100,000,000（我们的恒定乘积）和 122,400 / 817 = 150，我们的新价格）。提取我们有权获得的 10% 现在将产生 12,240 DAI 和 81.7 ETH。这里的总市场价值为 24,500 美元。由于做市，大约损失了价值 500 美元的利润。

显然，没有人愿意通过慈善的方式提供流动性，而且收入并不取决于从良好交易中转出的能力（不存在转出）。相反，所有交易量的 0.3% 按比例分配给所有流动性提供者。默认情况下，这些费用会放回流动性池中，但可以随时收取。如果不知道中间交易的数量，就很难知道费用收入和方向性变动造成的损失之间的权衡。来回波动越多越好。

### 为何我的流动资金价值低于我投入的金额
要理解为什么流动性提供者的股份价值尽管有费用收入却会下降，我们需要更仔细地研究 SwapX 用于管理交易的公式。这个公式真的很简单。如果我们忽略交易费，我们有以下公式：

- eth_liquidity_pool * token_liquidity_pool = constant_product
  
换句话说，交易者用 XOC 获得的代币数量以及反之亦然，是这样计算的：交易后，两个流动性池的乘积与交易前相同。这个公式的结果是，对于价值与流动性池规模相比非常小的交易，我们有：

- eth_price = token_liquidity_pool / eth_liquidity_pool
  
结合这两个等式，我们可以计算出每个流动性池在任意给定价格下的规模（假设总流动性保持不变）：

- eth_liquidity_pool = sqrt(constant_product / eth_price)
- token_liquidity_pool = sqrt(constant_product * eth_price)
  
那么让我们看看价格变化对流动性提供者的影响。为了简单起见，我们假设我们的流动性提供者向 SwapX DAI 交易所提供 1 XOC 和 100 DAI，为他们提供包含 100 XOC 和 10,000 DAI 的流动性池的 1%。这意味着价格为 1 XOC = 100 DAI。仍然忽略费用，让我们假设经过一些交易后，价格发生了变化；1 XOC 现在价值 120 DAI。流动性提供者的股份的新价值是多少？将数字代入上面的公式，我们得到：

- eth_liquidity_pool = 91.2871
- dai_liquidity_pool = 10954.4511

“由于我们的流动性提供者拥有 1% 的流动性代币，这意味着他们现在可以从流动性池中领取 0.9129 XOC 和 109.54 DAI。但由于 DAI 大约相当于美元，我们可能更愿意将全部金额转换为 DAI，以了解价格变化的整体影响。按当前价格计算，我们的流动性总价值为 219.09 DAI。如果流动性提供者只是持有他们最初的 1 XOC 和 100 DAI 会怎样？好吧，现在我们可以很容易地看到，按新价格计算，总价值将是 220 DAI。因此，我们的流动性提供者通过向 SwapX 提供流动性而不是仅仅持有他们最初的 XOC 和 DAI 而损失了 0.91 DAI。”

“当然，如果价格回到流动性提供者增加流动性时的价格，这种损失就会消失。因此，我们可以称之为 无常损失。利用上面的公式，我们可以得出一个公式，根据流动性供应时和现在的价格比率来计算无常损失的大小。我们得到以下结果：”

- “ impermanent_loss = 2 * sqrt(price_ratio) / (1+price_ratio) — 1“

- “或者换句话说：”
    - “1.25 倍的价格变化导致相对于 HODL 的 0.6% 的损失”
    - “相对于 HODL，1.50 倍的价格变化导致 2.0% 的损失”
    - “1.75 倍的价格变化导致相对于 HODL 的 3.8% 的损失”
    - “2 倍的价格变化导致相对于 HODL 的 5.7% 的损失”
    - “3 倍的价格变化导致相对于 HODL 的 13.4% 的损失”
    - “4 倍的价格变化导致相对于 HODL 的损失为 20.0%”
    - “与 HODL 相比，5 倍的价格变化导致 25.5% 的损失”
- “注意：无论价格朝哪个方向变化，损失都是相同的（即价格翻倍与减半造成的损失相同）。” 